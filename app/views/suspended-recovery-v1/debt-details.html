{# Template overrides #}
{% extends "layout.html" %}
{% block footer %}{% endblock %}

{# Import macros #}
{% from ScenarioPath + 'macros/key-details.njk' import keyDetails as keyDetails %}
{% from ScenarioPath + 'macros/breadcrumbs.njk' import breadcrumbs as breadcrumbs %}


{% set totalRepaid = 0 %}
{% set repaymentRows = [] %}

{% for repayment in Repayments | sort(true, true, 'datetime') %}

     {% set repaymentRows = (repaymentRows.push(
        [{
          text: repayment.datetime | date
        },
        {
          html: '<a href="' + Breadcrumbs.debtSummary.url + '/repayment-details/' + repayment.id + '" class="govuk-link">' + repayment.method + '</a>' 
        },
        {
        text: "£" + repayment.amount.toFixed(2),
        format: "numeric"
        }]), repaymentRows) %} 



    {% set totalRepaid = totalRepaid + repayment.amount %}
{% endfor %}


{% block header %}
  {{ keyDetails(Person) }}
  {{ breadcrumbs(links=Breadcrumbs) }}
{% endblock %}


{% block content %}

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">

      <section class="section">
        <h2 class="govuk-heading-m">
          {{ Debt.title }}
        </h2>

        {% if Debt.status == 'recover' %} 
          <strong class="govuk-tag">In recovery</strong>
          {% set statusStyle = '' %}
        {% elseif Debt.status == 'hold' %}
          {% set statusStyle = 'key-values--grey' %}
          
          <strong class="govuk-tag govuk-tag--grey">On hold</strong>
          <p class="govuk-!-margin-top-4">This is some placeholder text to explain to the agent that this debt is hold because there is no current functionality to allow this debt to be recovered.</p>

          <div class="hmcts-banner">
            <svg class="hmcts-banner__icon" fill="currentColor" role="presentation" focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 25 25" height="25" width="25">
            <path d="M13.7,18.5h-2.4v-2.4h2.4V18.5z M12.5,13.7c-0.7,0-1.2-0.5-1.2-1.2V7.7c0-0.7,0.5-1.2,1.2-1.2s1.2,0.5,1.2,1.2v4.8
            C13.7,13.2,13.2,13.7,12.5,13.7z M12.5,0.5c-6.6,0-12,5.4-12,12s5.4,12,12,12s12-5.4,12-12S19.1,0.5,12.5,0.5z" /></svg>

            <div class="hmcts-banner__message">
              <span class="hmcts-banner__assistive">information</span>
              <h3 class="govuk-heading-s">Communication Guidance</h3>
              <p>This is a placeholder for some guidance aimed at agents. The message should relay what to communicate to citizens so they know why their debt is on hold i.e. due to current functionality and that the debt will be collected in future.</p>
              <p>Additionally, there may be options the agent may need to communicate to the citizen.</p>
            </div>
          </div>

          
           <hr>
        {% endif %}

        <dl class="govuk-clearfix govuk-section-break--l key-values {{ statusStyle }}">
          <div class="key-values-col govuk-grid-column-one-third">
            <dt class="govuk-caption-m govuk-!-margin-bottom-0">Original balance</dt>
            <dd class="govuk-heading-l govuk-!-margin-left-0">£{{ Debt.originalBalance.toFixed(2) }}</dd>
          </div>
          <div class="key-values-col govuk-grid-column-one-third">
            <dt class="govuk-caption-m govuk-!-margin-bottom-0">Amount repaid</dt>
            <dd class="govuk-heading-l govuk-!-margin-left-0">£{{ totalRepaid.toFixed(2) }}</dd>
          </div>
          <div class="key-values-col govuk-grid-column-one-third">
            <dt class="govuk-caption-m govuk-!-margin-bottom-0">Amount owed</dt>
            <dd class="govuk-heading-l govuk-!-margin-left-0">£{{ (Debt.originalBalance - totalRepaid).toFixed(2) }}</dd>
          </div> 
        </dl>

        <div class="govuk-clearfix govuk-!-margin-top-5">
          <div class="govuk-grid-column-one-half govuk-!-padding-left-0">    
            <dl class="govuk-summary-list govuk-summary-list--no-border govuk-!-margin-bottom-0">

                <div class="govuk-summary-list__row">
                  <dt class="govuk-summary-list__key">
                    Advance received
                  </dt>
                  <dd class="govuk-summary-list__value">
                    {{ Debt.debtStart | date }}
                  </dd>
                </div>

                {% if Debt.debtNextPayment %}
                  <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">
                      Next repayment due
                    </dt>
                    <dd class="govuk-summary-list__value">
                      {{ Debt.debtNextPayment | date }}
                    </dd>
                  </div>
                {% endif %}
            </dl>
          </div>
        </div>
      </section>

      <hr>

      <section class="govuk-!-margin-bottom-2">
        <h2 class="card-title govuk-heading-m govuk-!-font-weight-regular">
          Repayment history
        </h2>
        {% if Repayments.length > 0 %}
          {{ govukTable({
              classes: "",
              firstCellIsHeader: false,
              
              head: [
                {
                  text: "Date"
                },
                
                {
                  text: "Repayment Method"
                },
                {
                  text: "Amount",
                  format: "numeric"
                }
              ],

              rows: repaymentRows
            }) }}
          {% else %}
            <p class="govuk-!-font-weight-bold">No repayments received.</p>
          {% endif %}
        </section>
    </div>
    
  </div>

{% endblock %}