{# Template overrides #}
{% extends "layout.html" %}
{% block footer %}{% endblock %}

{# Import macros #}
{% from ScenarioPath + 'macros/key-details.njk' import keyDetails as keyDetails %}
{% from ScenarioPath + 'macros/breadcrumbs.njk' import breadcrumbs as breadcrumbs %}


{% set totalRepaid = 0 %}
{% set repaymentRows = [] %}

{% for repayment in Repayments | sort(true, true, 'datetime') %}

     {% set repaymentRows = (repaymentRows.push(
        [{
          text: repayment.datetime | date
        },
        {
          html: '<a href="' + Breadcrumbs.debtSummary.url + '/repayment-details/' + repayment.id + '" class="govuk-link">' + repayment.method + '</a>' 
        },
        {
        text: "£" + repayment.amount.toFixed(2),
        format: "numeric"
        }]), repaymentRows) %} 



    {% set totalRepaid = totalRepaid + repayment.amount %}
{% endfor %}


{% block header %}
  {{ keyDetails(Person) }}
  {{ breadcrumbs(links=Breadcrumbs) }}
{% endblock %}


{% block content %}

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">

      <section class="section">
        <h2 class="govuk-heading-m">
          {{ Debt.title }}
        </h2>
        <dl class="govuk-clearfix govuk-section-break--l key-values ">
          <div class="key-values-col govuk-grid-column-one-third">
            <dt class="govuk-caption-m govuk-!-margin-bottom-0">Original balance</dt>
            <dd class="govuk-heading-l govuk-!-margin-left-0">£{{ Debt.originalBalance.toFixed(2) }}</dd>
          </div>
          <div class="key-values-col govuk-grid-column-one-third">
            <dt class="govuk-caption-m govuk-!-margin-bottom-0">Amount repaid</dt>
            <dd class="govuk-heading-l govuk-!-margin-left-0">£{{ totalRepaid.toFixed(2) }}</dd>
          </div>
          <div class="key-values-col govuk-grid-column-one-third">
            <dt class="govuk-caption-m govuk-!-margin-bottom-0">Amount owed</dt>
            <dd class="govuk-heading-l govuk-!-margin-left-0">£{{ (Debt.originalBalance - totalRepaid).toFixed(2) }}</dd>
          </div> 
        </dl>

        <div class="govuk-clearfix govuk-!-margin-top-5">
          <div class="govuk-grid-column-one-half govuk-!-padding-left-0">    
            
            {{ govukSummaryList({
                classes: 'govuk-summary-list--no-border govuk-!-margin-bottom-0',
                rows: [              
                  {
                    key: {
                      text: "Advance received",
                      class: "govuk-table__header"
                    },
                    value: {
                      text: Debt.debtStart | date,
                      format: "numeric"
                    }
                  },
                  {
                    key: {
                      text: "Next repayment due"
                    },
                    value: {
                      text: Debt.debtNextPayment | date,
                      format: "numeric"
                    }
                  }
                
                ]
              }) }}  
          </div>
        </div>
      </section>

      <hr>

      <section class="govuk-!-margin-bottom-2">
        <h2 class="card-title govuk-heading-m govuk-!-font-weight-regular">
          Repayment history
        </h2>

        {{ govukTable({
            classes: "",
            firstCellIsHeader: false,
            
            head: [
              {
                text: "Date"
              },
              
              {
                text: "Repayment Method"
              },
              {
                text: "Amount",
                format: "numeric"
              }
            ],

            rows: repaymentRows
          }) }}
        </section>
    </div>
    
  </div>

{% endblock %}